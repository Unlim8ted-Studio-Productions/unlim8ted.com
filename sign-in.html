<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Unlim8ted Sign-In</title>
  <link rel="icon" href="https://unlim8ted.com/favicon.ico" type="image/x-icon" />

  <style>
    :root{
      --bg1:#0f0c29; --bg2:#302b63; --bg3:#24243e;
      --panel:rgba(30,30,30,.92);
      --accent:#00ff99;
      --accent2:#00cc77;
      --text:#e0e0e0;
      --muted:#b0b0b0;
    }

    body{
      font-family: Arial, sans-serif;
      background: radial-gradient(circle at center, var(--bg1), var(--bg2), var(--bg3));
      margin:0;
      min-height:100vh;
      display:flex;
      justify-content:center;
      align-items:center;
      color:var(--text);
      overflow:hidden;
      padding-top:56px; /* space for navbar */
      box-sizing:border-box;
    }

    /* Background blobs */
    .background{
      position:fixed;
      inset:0;
      overflow:hidden;
      z-index:-1;
    }
    .background span{
      position:absolute;
      width:50px;height:50px;
      background: linear-gradient(45deg, var(--accent), #ff0077);
      opacity:.7;
      filter: blur(8px);
      animation: float 6s infinite ease-in-out;
      border-radius:50%;
    }
    @keyframes float{
      0%,100%{ transform: translateY(0) translateX(0); }
      50%{ transform: translateY(-40px) translateX(20px); }
    }

    /* Navbar */
    .navbar{
      position:fixed;
      top:0; left:0; right:0;
      display:flex;
      justify-content:center;
      background-color:#333333d0;
      z-index:3;
    }
    .navbar-header{
      width:100%;
      max-width:1100px;
      position:relative;
    }
    .navbar-toggle{
      display:none;
      background:#333;
      color:#fff;
      padding:10px 14px;
      border:none;
      cursor:pointer;
      font-size:18px;
      position:absolute;
      top:6px;
      left:10px;
      border-radius:8px;
    }
    .nav-links{
      list-style:none;
      padding:0;
      margin:0;
      display:flex;
      justify-content:center;
      gap:0;
    }
    .nav-item a{
      display:block;
      color:#fff;
      padding:14px 18px;
      text-decoration:none;
      text-align:center;
      white-space:nowrap;
    }
    .nav-item a:hover{
      background:#15131f;
      color:rgb(51,207,103);
    }
    .nav-item.dropdown{ position:relative; }
    .dropdown-content{
      display:none;
      position:absolute;
      left:0;
      background:#251f1f;
      box-shadow:0 8px 16px rgba(0,0,0,.2);
      min-width:180px;
      z-index:5;
    }
    .dropdown-content a{
      color:#fff;
      padding:12px 16px;
      display:block;
      text-align:left;
    }
    .dropdown-content a:hover{ background:#2d2849; }
    .dropdown:hover .dropdown-content{ display:block; }

    .nav-links .old-site-btn{
      display:flex;
      align-items:center;
      padding:0 10px;
    }
    .nav-links .old-site-btn button{
      border:none;
      border-radius:10px;
      padding:8px 12px;
      cursor:pointer;
    }

    @media (max-width:768px){
      .navbar-toggle{ display:block; }
      .nav-links{
        flex-direction:column;
        display:none;
        background-color:#333333f2;
        padding-top:48px;
      }
      .nav-links.show{ display:flex; }
      .dropdown-content{ position:relative; box-shadow:none; }
    }

    /* Auth card */
    .container{
      text-align:center;
      background:var(--panel);
      border-radius:15px;
      box-shadow:0 10px 30px rgba(0,255,153,.3);
      padding:2rem;
      max-width:420px;
      width:min(92vw, 420px);
      margin:20px;
    }
    .logo{
      font-size:2rem;
      font-weight:bold;
      color:var(--accent);
      margin-bottom:.25rem;
      text-shadow:0 0 10px var(--accent);
    }
    .subtitle{ margin:0 0 1rem; color:var(--muted); }

    button{
      padding:10px 16px;
      border:none;
      border-radius:12px;
      font-size:16px;
      cursor:pointer;
      width:100%;
    }

    #google-signin-btn{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      background:var(--accent);
      color:var(--bg3);
      border-radius:25px;
      box-shadow:0 5px 10px rgba(0,255,153,.3);
      transition:background-color .2s ease;
    }
    #google-signin-btn:hover{ background:var(--accent2); }
    #google-signin-btn img{ width:20px; height:20px; }

    form{ margin:0; }
    #email-signin-form input{
      padding:10px;
      margin:0 0 10px;
      width:100%;
      border:none;
      border-radius:10px;
      outline:none;
      box-sizing:border-box;
    }
    #form-submit{
      background:var(--accent);
      color:var(--bg3);
    }
    #form-submit:hover{ background:var(--accent2); }

    .row{
      display:flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      margin:6px 0 14px;
      font-size:0.95rem;
      color:var(--muted);
    }
    .remember{
      display:flex;
      align-items:center;
      gap:8px;
      user-select:none;
      cursor:pointer;
      white-space: nowrap;
    }
    .remember input{ transform: translateY(5px); accent-color: var(--accent); }

    .info{
      margin-top:1rem;
      font-size:.9rem;
      color:var(--muted);
      line-height:1.35;
    }
    .info a{
      color:var(--accent);
      text-decoration:none;
      font-weight:bold;
    }
    .info a:hover{ text-decoration:underline; }

    .toggle{
      cursor:pointer;
      color:var(--accent);
      text-decoration:underline;
      margin:0.75rem 0 0.25rem;
      display:inline-block;
    }
    .divider{ margin: 1rem 0; color: var(--muted); }
  </style>

  <script>
    function toggleMenu(){
      document.getElementById("navbarLinks").classList.toggle("show");
    }
  </script>

  <nav class="navbar">
    <div class="navbar-header">
      <button class="navbar-toggle" onclick="toggleMenu()">â˜°</button>
      <ul class="nav-links" id="navbarLinks">
        <li class="nav-item"><a href="/">Home</a></li>
        <li class="nav-item"><a href="products">Products</a></li>
        <li class="nav-item"><a href="contact">Contact</a></li>
        <li class="nav-item"><a href="about">About</a></li>
        <li class="nav-item dropdown">
          <a href="javascript:void(0)">More</a>
          <div class="dropdown-content">
            <a href="portfolio">Portfolio</a>
            <a href="blog">Blog</a>
          </div>
        </li>
        <li class="old-site-btn"><a href="old"><button type="button">Old site</button></a></li>
      </ul>
    </div>
  </nav>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import {
      getAuth,
      GoogleAuthProvider,
      signInWithPopup,
      signInWithEmailAndPassword,
      createUserWithEmailAndPassword,
      setPersistence,
      browserLocalPersistence,
      browserSessionPersistence,
      onAuthStateChanged,
    } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-auth.js";
    import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyC8rw6kaFhJ2taebKRKKEA7iLqBvak_Dbc",
      authDomain: "unlim8ted-db.firebaseapp.com",
      projectId: "unlim8ted-db",
      storageBucket: "unlim8ted-db.appspot.com",
      messagingSenderId: "1059428499872",
      appId: "1:1059428499872:web:855308683718237de6e4c5",
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const redirectToProfile = () => (window.location.href = "https://unlim8ted.com/profile");

    // If already signed in, bounce to profile (optional but nice)
    onAuthStateChanged(auth, (user) => {
      if (user) redirectToProfile();
    });

    async function addUserToFirestore(user){
      const userRef = doc(db, "users", user.uid);
      await setDoc(userRef, {
        email: user.email,
        name: user.displayName || null,
        createdAt: serverTimestamp(),
      }, { merge: true });
    }

    async function applyPersistenceFromCheckbox(){
      const remember = document.getElementById("rememberMe")?.checked ?? true;
      await setPersistence(auth, remember ? browserLocalPersistence : browserSessionPersistence);
    }

    async function handleGoogleSignIn(){
      const provider = new GoogleAuthProvider();
      try{
        await applyPersistenceFromCheckbox();
        const result = await signInWithPopup(auth, provider);
        await addUserToFirestore(result.user);
        redirectToProfile();
      }catch(err){
        console.error("Google Sign-In error:", err);
        alert("Failed to sign in with Google.");
      }
    }

    async function handleEmailSignIn(email, password){
      await applyPersistenceFromCheckbox();
      const userCredential = await signInWithEmailAndPassword(auth, email, password);
      await addUserToFirestore(userCredential.user);
      redirectToProfile();
    }

    async function handleAccountCreation(email, password){
      await applyPersistenceFromCheckbox();
      const userCredential = await createUserWithEmailAndPassword(auth, email, password);
      await addUserToFirestore(userCredential.user);
      redirectToProfile();
    }

    let isCreateMode = false;

    function setMode(createMode){
      isCreateMode = createMode;

      document.getElementById("form-mode").textContent = createMode ? "Create Account" : "Sign In";
      document.getElementById("form-submit").textContent = createMode ? "Create Account" : "Sign In";
      document.getElementById("toggle-text").textContent = createMode
        ? "Already have an account? Sign In."
        : "Don't have an account? Create one.";
    }

    function toggleMode(){
      setMode(!isCreateMode);
    }

    window.addEventListener("DOMContentLoaded", () => {
      document.getElementById("google-signin-btn").addEventListener("click", handleGoogleSignIn);
      document.getElementById("toggle-text").addEventListener("click", toggleMode);

      // Use the FORM submit event (more reliable than button click)
      document.getElementById("email-signin-form").addEventListener("submit", async (e) => {
        e.preventDefault();
        const email = document.getElementById("email").value.trim();
        const password = document.getElementById("password").value;

        try{
          if (isCreateMode) {
            await handleAccountCreation(email, password);
          } else {
            await handleEmailSignIn(email, password);
          }
        }catch(err){
          console.error("Auth error:", err);
          alert(isCreateMode
            ? "Failed to create account. Try again."
            : "Sign-in failed. Check your email and password."
          );
        }
      });

      setMode(false);

      // Footer year
      const y = new Date().getFullYear();
      document.getElementById("footer-text").innerHTML =
        `&copy; 2019-${y} Unlim8ted Studio Productions. All rights reserved.`;
    });
  </script>
</head>

<body>
  <div class="background">
    <span style="top: 20%; left: 10%; animation-delay: 0s;"></span>
    <span style="top: 40%; left: 70%; animation-delay: 2s;"></span>
    <span style="top: 70%; left: 30%; animation-delay: 4s;"></span>
    <span style="top: 50%; left: 90%; animation-delay: 1.5s;"></span>
    <span style="top: 80%; left: 50%; animation-delay: 3s;"></span>
  </div>

  <div class="container">
    <div class="logo">Unlim8ted</div>
    <p class="subtitle">Sign in or create an account to continue.</p>

    <div id="form-mode" style="font-weight:700; margin-bottom: 10px;">Sign In</div>

    <button id="google-signin-btn" type="button">
      <img
        src="https://lh3.googleusercontent.com/COxitqgJr1sJnIDe8-jiKhxDx1FrYbtRHKJ9z_hELisAlapwE9LUPh6fcXIfb5vwpbMl4xl9H9TRFPc5NOO8Sb3VSgIBrfRYvW6cUA"
        alt="Google Logo" />
      Sign in with Google
    </button>

    <div class="divider">Or</div>

    <form id="email-signin-form">
      <input type="email" id="email" placeholder="Email" autocomplete="email" required />
      <input type="password" id="password" placeholder="Password" autocomplete="current-password" required />

      <div class="row">
        <label class="remember" for="rememberMe">
          <input id="rememberMe" type="checkbox" checked />
          Remember me
        </label>
      </div>

      <button id="form-submit" type="submit">Sign In</button>

      <div class="info">
        <span id="toggle-text" class="toggle">Don't have an account? Create one.</span>
        <p>An account is needed to comment, rate products, and add things to your cart, but it is not required.</p>
        <p>If you'd prefer not to create an account, you can visit our <a href="products">Products</a> or <a href="about">About Us</a> pages.</p>
        <p id="footer-text"></p>
      </div>
    </form>
  </div>
</body>
</html>
